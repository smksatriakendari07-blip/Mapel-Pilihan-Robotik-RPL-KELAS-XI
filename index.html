<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aplikasi_ujian</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #ffffff;
        }

        .header {
            width: 100%;
            padding: 10px;
            background: #510375;
            color: #fff;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        iframe {
            width: 100vw;
            height: calc(100vh - 50px);
            border: none;
        }
    </style>
</head>
<body>

<div class="header">APLIKASI UJIAN</div>

<iframe id="formUjian"
 src="https://docs.google.com/forms/d/e/1FAIpQLSfBEUtFLPXxvdoFrPWFLZLreg6_zgQpfbGPWUXzfu97KvJLPA/viewform?usp=publish-editor">
</iframe>

<script>
// ================================================
// 1. CEK PARAMETER QR PALING AWAL (HARUS DITEMPATKAN DI BARIS PERTAMA)
// ================================================
const urlParams = new URLSearchParams(window.location.search);

if (urlParams.get("unlock") === "1") {
    // hapus kunci sebelum halaman lain berjalan
    localStorage.removeItem("terkunci");
    localStorage.removeItem("pelanggaran");
}

// ================================================
// 2. LOAD STATUS KUNCI
// ================================================
let pelanggaran = localStorage.getItem("pelanggaran")
    ? parseInt(localStorage.getItem("pelanggaran"))
    : 0;

// JIKA MASIH TERKUNCI → JANGAN TAMPILKAN FORM
if (localStorage.getItem("terkunci") === "true") {
    kunciHalaman();
}

// ================================================
// 3. DETEKSI KELUAR HALAMAN
// ================================================
document.addEventListener("visibilitychange", function () {
    if (document.hidden) {
        pelanggaran++;
        localStorage.setItem("pelanggaran", pelanggaran);

        localStorage.setItem("terkunci", "true");
        kunciHalaman();
    }
});

// ================================================
// 4. TAMPILAN HALAMAN TERKUNCI
// ================================================
function kunciHalaman() {
    document.body.innerHTML = `
        <h1 style="
            color:#d10000;
            text-align:center;
            margin-top:60px;
            font-size:42px;
            font-weight:bold;">⚠️ HALAMAN UJIAN TERKUNCI</h1>

        <p style="text-align:center; font-size:22px; margin-top:20px;">
            Sistem mendeteksi bahwa Anda meninggalkan halaman ujian.
        </p>

        <p style="text-align:center; font-size:20px; margin-top:10px;">
            Anda telah keluar sebanyak <b>${pelanggaran} kali</b>.
        </p>

        <p style="text-align:center; font-size:20px; margin-top:40px;">
            Untuk membuka halaman kembali, silakan <b>scan ulang QR dari pengawas</b>.
        </p>
    `;
}
</script>

</body>
</html>

