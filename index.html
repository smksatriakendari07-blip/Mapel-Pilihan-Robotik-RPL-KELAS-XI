<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aplikasi_ujian</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #ffffff;
        }

        .header {
            width: 100%;
            padding: 10px;
            background: #510375;
            color: #fff;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        iframe {
            width: 100vw;
            height: calc(100vh - 50px);
            border: none;
        }
    </style>
</head>
<body>

<div class="header">APLIKASI UJIAN</div>

<iframe id="formUjian"
 src="https://docs.google.com/forms/d/e/1FAIpQLSfBEUtFLPXxvdoFrPWFLZLreg6_zgQpfbGPWUXzfu97KvJLPA/viewform?usp=publish-editor">
</iframe>

<script>
// ==========================
// KONFIGURASI QR
// ==========================
const KODE_QR = "UNLOCK-12345";

// ==========================
// LOAD STATUS
// ==========================
let pelanggaran = localStorage.getItem("pelanggaran")
    ? parseInt(localStorage.getItem("pelanggaran"))
    : 0;

if (localStorage.getItem("terkunci") === "true") {
    kunciHalaman();
}

// ==========================
// DETEKSI KELUAR HALAMAN
// ==========================
document.addEventListener("visibilitychange", function () {
    if (document.hidden) {
        pelanggaran++;
        localStorage.setItem("pelanggaran", pelanggaran);

        localStorage.setItem("terkunci", "true");
        kunciHalaman();
    }
});

// ==========================
// FUNGSI KUNCI HALAMAN
// ==========================
function kunciHalaman() {
    document.body.innerHTML = `
        <h1 style="
            color:#d10000;
            text-align:center;
            margin-top:60px;
            font-size:42px;
            font-weight:bold;
            letter-spacing:2px;">⚠️ HALAMAN UJIAN TERKUNCI</h1>

        <p style="text-align:center; font-size:22px; margin-top:20px;">
            Sistem mendeteksi bahwa Anda meninggalkan halaman ujian.
        </p>

        <p style="text-align:center; font-size:20px; margin-top:10px; color:#444;">
            Anda telah keluar sebanyak <b>${pelanggaran} kali</b>.
        </p>

        <div style="text-align:center; margin-top:40px;">
            <p>Masukkan kode QR dari pengawas untuk membuka kunci:</p>
            <input id="unlockInput" style="padding:10px; font-size:18px;" placeholder="Kode QR">
            <button id="btnUnlock" style="padding:10px 20px; font-size:18px;">Buka Kunci</button>
        </div>
    `;

    // >>> HUBUNGKAN TOMBOL SETELAH HALAMAN DI-RENDER <<<
    document.getElementById("btnUnlock").addEventListener("click", unlock);
}

// ==========================
// UNLOCK HALAMAN
// ==========================
function unlock() {
    const input = document.getElementById("unlockInput").value;

    if (input === KODE_QR) {
        localStorage.setItem("terkunci", "false");
        alert("✔️ Halaman berhasil dibuka kembali.");
        location.reload();
    } else {
        alert("❌ Kode QR salah! Periksa kembali.");
    }
}
</script>

</body>
</html>
